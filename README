# ğŸš API de Monitoreo de Conductores y Rutas en Tiempo Real

Este proyecto es una API construida con **FastAPI** para el monitoreo de conductores, rutas, y viajes en tiempo real. Utiliza PostgreSQL como base de datos, y Google Cloud Storage para el manejo de imÃ¡genes. La autenticaciÃ³n se realiza mediante una API Key.

---

## ğŸ“¦ TecnologÃ­as Utilizadas

- FastAPI
- PostgreSQL (con `asyncpg` y `SQLAlchemy`)
- Google Cloud Storage
- Pydantic
- CORS Middleware
- Logging con rotaciÃ³n de archivos

---

## ğŸ” AutenticaciÃ³n

Todas las rutas estÃ¡n protegidas mediante una API Key enviada en el header:



Puedes cambiar la clave directamente en el archivo principal (`main.py`) o usar una variable de entorno para mayor seguridad.

---

## ğŸ› ï¸ ConfiguraciÃ³n Inicial

1. **Base de datos PostgreSQL:**
   - La conexiÃ³n estÃ¡ configurada para un host externo (`148.241.200.8`) y/o local (`localhost`) en la base de datos `transporte`.

2. **Google Cloud Storage:**
   - AsegÃºrate de tener un archivo de credenciales JSON vÃ¡lido.
   - Configura la ruta en `GOOGLE_CLOUD_CREDENTIALS`.
   - AsegÃºrate de que el bucket `info_club` exista y tenga permisos de escritura.

3. **Archivo `back_querys.sql`:**
   - Este archivo contiene la lÃ³gica de registro de viajes. Se encarga de rastrear el inicio y final de una ruta, considerando un radio de **50 metros** para definir el retorno al punto de origen.
   - Debe ejecutarse en la base de datos bajo el esquema `prueba_transporte`.

---

## ğŸš€ CÃ³mo Ejecutar

1. Clona el repositorio.
2. Instala los paquetes necesarios:

```bash
pip install -r requirements.txt


ğŸ“‚ Endpoints Principales
ğŸ”¸ Conductores
GET /conductores/: Lista de conductores.

PUT /conductores/{idconductor}: Actualiza los datos de un conductor.

ğŸ”¸ Viajes
GET /viajes/historial/: Obtiene viajes histÃ³ricos (paginado).

GET /viajes/realtime/: Obtiene datos en tiempo real desde una vista.

ğŸ”¸ Choferes
POST /choferes/registrar/: Registra un nuevo chofer con imagen (form-data).

PUT /choferes/{nombre_apellido}/status: Cambia el estado (activo/inactivo) de un chofer.

GET /choferes/: Lista choferes con filtro opcional por nombre.



 #######    Consideraciones  ########
El proyecto maneja mÃºltiples conexiones con un pool configurado para alto rendimiento.

Las imÃ¡genes subidas de choferes se almacenan en el bucket bajo el prefijo fotos_choferes_bsf/.

Todas las rutas estÃ¡n protegidas por autenticaciÃ³n basada en API Key.

Compatible con despliegues en entornos como GCP, Docker, o servidores locales.

